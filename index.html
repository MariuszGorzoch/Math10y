<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Kosmiczna Misja Stisia ‚Äî gra matematyczna</title>
  <style>
    :root{
      --bg:#0b1220;--card:#111a2e;--accent:#6cf;--accent2:#9ff;--good:#34d399;--bad:#ef4444;--text:#e6f0ff;--muted:#9bb3d1;--star:#ffe27a
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 70% -10%, #1b2a4b 0%, var(--bg) 60%),
                  radial-gradient(900px 600px at -10% 110%, #12203a 0%, var(--bg) 60%);
      color:var(--text);
      overflow:hidden;
    }
    .stars{position:fixed; inset:0; pointer-events:none; z-index:-1}
    .star{position:absolute; width:2px; height:2px; background:var(--star); opacity:.8; border-radius:50%;
          animation: twinkle 2.5s infinite ease-in-out}
    @keyframes twinkle{ 0%,100%{opacity:.15; transform:scale(.7)} 50%{opacity:.9; transform:scale(1)} }

    .container{width:100%; max-width:980px; margin:0 auto; padding:calc(10px + env(safe-area-inset-top)) 12px calc(10px + env(safe-area-inset-bottom)) 12px; min-height:100dvh; display:flex; flex-direction:column; gap:10px}
    header{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .titleBox{display:flex; align-items:center; gap:10px}
    .mascot{
      width:60px;
      height:60px;
      border-radius:50%;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
      animation:float 3s ease-in-out infinite;
      object-fit:cover;
    }
    .title{font-size: clamp(18px, 2.6vw, 30px); font-weight:800; letter-spacing:.2px}

    .panel{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:14px; box-shadow:0 10px 26px rgba(5,12,28,.45)}

    .hud{display:grid; grid-template-columns:1fr auto auto; gap:8px; align-items:center}
    .progress{height:10px; background:#0a1428; border:1px solid rgba(255,255,255,.07); border-radius:999px; overflow:hidden}
    .progress > i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width .35s ease}
    .badge{padding:8px 10px; border-radius:999px; background:#0b1630; border:1px solid rgba(255,255,255,.08); font-weight:600}

    main{margin:0; display:flex; flex-direction:column; gap:12px; flex:1; min-height:0}
    .question{font-size:18px; font-weight:700}
    .qtitle{color:var(--muted); font-size:14px}
    .question img{max-width:100%; margin-top:8px; border:1px solid rgba(255,255,255,.1); border-radius:6px}
    .options{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px; margin-top:6px; flex:1; align-content:start}
    .btn{padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:#0f1d38; color:var(--text);
      cursor:pointer; font-weight:700; text-align:center; transition: transform .08s ease, border-color .2s, background .2s; user-select:none}
    .btn:hover{transform:translateY(-2px); border-color:var(--accent)}
    .btn:active{transform:translateY(0)}
    .btn.correct{background:rgba(52,211,153,.15); border-color:var(--good)}
    .btn.wrong{background:rgba(239,68,68,.15); border-color:var(--bad)}

    .speech{display:flex; align-items:flex-start; gap:8px; margin-top:4px}
    .bubble{background:#0a1a33; border:1px solid rgba(255,255,255,.08); padding:10px 12px; border-radius:12px; max-width:700px}
    .small{color:var(--muted); font-size:13px}

    .footer{display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:auto}
    .primary{background:linear-gradient(90deg,#34a3ff,#5fe3ff); color:#05223f}

    .buildInfo{text-align:center; font-size:12px; color:var(--muted); margin-top:8px}

    .hidden{display:none}
    .shake{animation:shake .38s cubic-bezier(.36,.07,.19,.97) both}
    @keyframes shake{10%, 90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

    .scoreRow{display:flex; gap:6px; align-items:center}
    .heart{font-size:20px; filter:drop-shadow(0 2px 0 rgba(0,0,0,.25))}

    .celebrate{position:fixed; inset:0; pointer-events:none; z-index:10}

    /* Silly rocket & boom */
    .rocket{position:fixed; top:0; left:0; font-size:32px; z-index:999; pointer-events:none; transition:transform 3s linear}
    .boom{position:fixed; font-size:48px; pointer-events:none; transform:translate(-50%,-50%) scale(.2); animation:boom .7s ease-out forwards; z-index:999}
    @keyframes boom{to{transform:translate(-50%,-50%) scale(1.6); opacity:0}}

    /* Summary ‚Äî pe≈Çnoekranowo dla screenshota */
    #summary{position:fixed; inset:0; border-radius:0; display:none; z-index:1000; background:var(--card)}
    #summary:not(.hidden){display:flex; flex-direction:column; align-items:center; padding:calc(20px + env(safe-area-inset-top)) 16px calc(16px + env(safe-area-inset-bottom)); gap:12px}
    #answersList{font-size:13px; line-height:1.3; background:#0a1428; padding:12px; border-radius:10px; overflow:auto; -webkit-overflow-scrolling:touch; max-height:100%; margin:0 auto; width:100%; max-width:720px}
    .sumTitle{font-size:28px; font-weight:900; text-align:center}
    .sumMeta{font-size:14px; color:var(--muted); text-align:center}
    .sumList{width:100%; max-width:720px; flex:1; overflow:auto; -webkit-overflow-scrolling:touch}
    .sumActions{width:100%; display:flex; justify-content:center}
    .jokeBox{max-width:720px; width:100%; text-align:center; background:#0a1a33; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:10px 12px; box-shadow:0 6px 18px rgba(5,12,28,.35); font-size:14px; color:var(--text)}
    #answersList .ok{color:var(--good); font-weight:700}
    #answersList .no{color:var(--bad); font-weight:700}

    .resultIcon{width:84px; height:84px}
    .flex{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}

    @media (max-width: 480px){
      .title{font-size:20px}
      .question{font-size:16px}
      .btn{padding:12px; font-size:16px}
    }
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>
  <div class="container">
    <header>
      <div class="titleBox">
        <img src="stitch.png" class="mascot" alt="Sti≈õ">
        <div>
          <div class="title">Kosmiczna Misja Stisia</div>
          <div class="small">Pom√≥≈º niebieskiemu kosmicie Stisiowi zbieraƒá ananasy, rozwiƒÖzujƒÖc zadania z matematyki! üçç</div>
        </div>
      </div>
      <div class="scoreRow">
        <span class="badge" id="level">Poziom: 1</span>
        <span class="badge" id="score">Punkty: 0</span>
        <span class="badge" id="lives" title="Liczba ≈ºyƒá">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
      </div>
    </header>

    <div class="panel hud">
      <div class="progress" aria-label="Postƒôp gry"><i id="bar"></i></div>
      <div class="badge" id="qidx">Pytanie 1/10</div>
      <button class="badge" id="resetBtn" title="Zacznij od nowa">‚Üª Restart</button>
    </div>

    <main class="panel" id="game">
      <div class="question" id="question">‚Ä¶</div>
      <div class="options" id="options"></div>

      <div class="speech">
        <img src="stitch.png" class="mascot" style="width:48px; height:48px" alt="Sti≈õ">
        <div class="bubble small" id="hint">Kliknij poprawnƒÖ odpowied≈∫. Za dobrƒÖ odpowied≈∫: +10 punkt√≥w i ananas üü°. Za b≈ÇƒÖd tracisz serduszko.</div>
      </div>

      <div class="footer">
        <button class="btn primary" id="nextBtn" disabled>Nastƒôpne ‚ûú</button>
        <div class="small">Wskaz√≥wka: Spr√≥buj na g≈Ços wyt≈Çumaczyƒá, jak liczysz ‚Äì to pomaga! üéØ</div>
      </div>
    </main>

    <section class="panel hidden" id="summary">
      <div class="sumTitle" id="summaryTitle">‚Äî</div>
      <div class="sumMeta" id="summaryTime">‚Äî</div>
      <div class="sumList">
        <div id="answersList" class="small"></div>
      </div>
      <div id="jokeBox" class="jokeBox" aria-live="polite"></div>
      <div class="sumActions">
        <button class="btn primary" id="againBtn">Zagraj ponownie</button>
      </div>
    </section>
    <div id="buildInfo" class="buildInfo small"></div>
  </div>

  <canvas class="celebrate" id="confetti" width="1920" height="1080"></canvas>

  <script>
    // --- Ma≈Çe gwiazdki w tle ---
    (function makeStars(){
      const box = document.getElementById('stars');
      const n = 120;
      for(let i=0;i<n;i++){
        const s=document.createElement('i'); s.className='star';
        s.style.left = Math.random()*100+'%';
        s.style.top = Math.random()*100+'%';
        s.style.animationDelay = (Math.random()*2.5)+'s';
        s.style.opacity = (0.2+Math.random()*0.8).toFixed(2);
        s.style.transform = `scale(${0.5+Math.random()*1.2})`;
        box.appendChild(s);
      }
    })();

    // === Generatory pyta≈Ñ ‚Äî nowe losowe liczby na ka≈ºde uruchomienie ===
    function ri(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    function pickFourWithCorrect(correct, pool){
      // wybierz 3 unikalne b≈Çƒôdne z puli, plus poprawnƒÖ, przetasuj
      const wrong = [];
      const seen = new Set([correct]);
      for(const v of pool){ if(wrong.length>=3) break; if(!seen.has(v) && v>=0){ wrong.push(v); seen.add(v); } }
      while(wrong.length<3){ const k = correct + ri(-10,10); if(!seen.has(k) && k>=0){ wrong.push(k); seen.add(k); } }
      const all = [correct,...wrong];
      return shuffleArray(all).slice(0,4);
    }

    function buildQuestions(){
      const qs = [];
      // 1. Suma
      { const a=ri(15,45), b=ri(10,35), c=a+b;
        const opts = pickFourWithCorrect(c,[c-1,c+1,c+10,c-10]);
        qs.push({ q:`Suma liczb ${a} i ${b} wynosi:`, opts:opts.map(x=>String(x)), correct:opts.indexOf(c) }); }

      // 2. R√≥≈ºnica
      { const a=ri(30,70), b=ri(10,Math.max(10,a-10)), c=a-b; const opts = pickFourWithCorrect(c,[c-1,c+1,c+5,c+10]);
        qs.push({ q:`R√≥≈ºnica liczb ${a} i ${b} wynosi:`, opts:opts.map(x=>String(x)), correct:opts.indexOf(c) }); }

      // 3. Zabawki (≈ºo≈Çnierze o K mniej)
      { const cars=ri(10,20), k=ri(3,8); const soldiers=cars-k; const opts = pickFourWithCorrect(soldiers,[soldiers+2,soldiers-2,cars,cars+k]);
        qs.push({ q:`W≈õr√≥d zabawek Wojtka jest ${cars} samochod√≥w, a ≈ºo≈Çnierzy ‚Äî o ${k} mniej. ≈ªo≈Çnierzy jest:`, opts:opts.map(x=>String(x)), correct:opts.indexOf(soldiers) }); }

      // 4. Spodnie ‚Äî r√≥≈ºnica ceny
      { const j=ri(50,110), z=j+ri(5,30); const diff=z-j; const pool=[diff-2,diff-1,diff+1,diff+3]; const opts = pickFourWithCorrect(diff,pool).map(x=>`${x} z≈Ç`);
        qs.push({ q:`Spodnie Jarka kosztowa≈Çy ${j} z≈Ç, a spodnie Zbyszka ‚Äî ${z} z≈Ç. Spodnie Zbyszka sƒÖ dro≈ºsze od spodni Jarka o:`, opts, correct:opts.findIndex(t=>t===`${diff} z≈Ç`) }); }

      // 5. Iloczyn
      { const a=[10,20,30,40][ri(0,3)], b=[10,20,30,40,50,60][ri(0,5)]; const c=a*b; const opts = pickFourWithCorrect(c,[a+b,c/10,c+20,c-20]);
        qs.push({ q:`Iloczyn liczb ${a} i ${b} wynosi:`, opts:opts.map(x=>String(x)), correct:opts.indexOf(c) }); }

      // 6. Babcia jest r razy starsza
      { const r=ri(6,9), p=ri(7,12), g=r*p; const opts = pickFourWithCorrect(p,[p-1,p+1,p+2,p+3]).map(x=>`${x} lat`);
        qs.push({ q:`Babcia Paw≈Ça ma ${g} lat i jest od Paw≈Ça ${r} razy starsza. Pawe≈Ç ma:`, opts, correct:opts.findIndex(t=>t===`${p} lat`) }); }

      // 7. Reszta z dzielenia
      { const A=ri(20,50), B=ri(3,9), r=A%B; const pool=[]; for(let i=0;i<Math.min(6,B);i++){ if(i!==r) pool.push(i); }
        const opts = pickFourWithCorrect(r,pool).map(x=>String(x));
        qs.push({ q:`Reszta z dzielenia liczby ${A} przez ${B} wynosi:`, opts, correct:opts.indexOf(String(r)) }); }

      // 8. Kolejno≈õƒá dzia≈Ça≈Ñ ( (A+B):C ¬∑ D )
      { const C=[2,3,4,6][ri(0,3)], D=ri(2,5), A=C*ri(3,9), B=C*ri(2,8); const val=((A+B)/C)*D; const opts = pickFourWithCorrect(val,[val- D, val/2, val+ C, val-1]);
        qs.push({ q:`Wynik dzia≈Çania (${A} + ${B}) : ${C} ¬∑ ${D} wynosi:`, opts:opts.map(x=>String(x)), correct:opts.indexOf(val) }); }

      // 9. Wiek Zosi i taty
      { const r=ri(4,6), dziecko=ri(6,10), mama=r*dziecko, T=ri(25,35), tata=dziecko+T; const pool=[tata-1,tata+1,mama, T];
        const opts = pickFourWithCorrect(tata,pool).map(x=>`${x} lat`);
        qs.push({ q:`Zosia jest ${r} razy m≈Çodsza od swojej mamy, kt√≥ra ma ${mama} lat. Tata Zosi jest od swojej c√≥rki o ${T} lat starszy i ma:`, opts, correct:opts.findIndex(t=>t===`${tata} lat`) }); }

      // 10. O≈õ liczbowa
      { const max=[60,80,100][ri(0,2)], pt=ri(1,7)* (max/8) | 0; // punkt blisko skali
        const point = Math.round(pt/5)*5; const pool=[point-10, point-5, point+5, point+10]; const opts = pickFourWithCorrect(point,pool).map(x=>String(x));
        qs.push({ q:`Wsp√≥≈Çrzƒôdna punktu A na osi liczb wynosi:`, opts, correct:opts.indexOf(String(point)), axis:{min:0,max,point} }); }

      return qs;
    }

    function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    // Kr√≥tkie polskie dowcipy (≈∫r√≥d≈Ça: patrz rozmowa)
    const JOKES_PL = [
      'Co m√≥wi d≈ºem, gdy siƒô go otwiera? ‚Äì D≈ºem dobry.',
      'Jak nazywa siƒô lekarz, kt√≥ry leczy pandy? ‚Äì Pandoktor.',
      'Co zabiera informatyk na turniej rycerski? ‚Äì Kopiƒô zapasowƒÖ.',
      'W g√≥rach ceny sƒÖ wysokie, a nad morzem ‚Äì s≈Çone.',
      'Jak siƒô nazywa kot, kt√≥ry leci? ‚Äì Kotlecik!',
      'Jak siƒô nazywa mina na powitanie? ‚Äì Witamina!',
      'Co robi traktor u fryzjera? ‚Äì Warkocze!',
      'Mama: ‚ÄûNie mo≈ºesz zje≈õƒá trzech deser√≥w pod rzƒÖd.‚Äù Ja≈õ: ‚ÄûAle ja je jem pod skosem.‚Äù',
      'Pani pyta: ‚ÄûCo to jest echo?‚Äù Ja≈õ: ‚ÄûUcze≈Ñ, kt√≥ry zawsze powtarza po innych.‚Äù',
      'Dziewczynka: ‚ÄûPoproszƒô lizaka za dwa z≈Çote.‚Äù Sprzedawca: ‚ÄûNie mamy.‚Äù Dziewczynka: ‚ÄûA za ile macie?‚Äù',
      '‚Äì Umiem liczyƒá do piƒôciu. ‚Äì To policz. ‚Äì Dwa, trzy, cztery, piƒôƒá. ‚Äì A gdzie jedynka? ‚Äì W dzienniczku.',
      'Dlaczego komputer nie lubi zimy? ‚Äì Bo ma za du≈ºo bug√≥w.',
      'Co m√≥wi krowa po obejrzeniu horroru? ‚Äì Muuu, jakie straszne!',
      'Dlaczego matematyk nie ufa windzie? ‚Äì Bo woli i≈õƒá po schodach, ma wiƒôkszƒÖ kontrolƒô.',
      'Jak siƒô nazywa ryba, kt√≥ra chodzi? ‚Äì ≈Åoso≈õ pieszy.',
      'Co robiƒÖ dwie cebule na randce? ‚Äì P≈ÇaczƒÖ z rado≈õci.',
      'Dlaczego s≈Ço≈Ñ nigdy nie korzysta z komputera? ‚Äì Bo boi siƒô myszy.',
      'Jak nazywa siƒô kr√≥lowa szach√≥w? ‚Äì Matka.',
      'Dlaczego kalendarz jest zawsze spokojny? ‚Äì Bo dni ma policzone.',
      'Jak siƒô nazywa mƒÖdrƒÖ pszczo≈Çƒô? ‚Äì Inteligentna.',
      'Co robi programista w ogr√≥dku? ‚Äì Sadzi bity.',
      'Dlaczego ciastko posz≈Ço do lekarza? ‚Äì Bo siƒô kruszy≈Ço.',
      'Jak siƒô nazywa samoch√≥d, kt√≥ry je≈∫dzi na herbatƒô? ‚Äì Autobus.',
      'Co m√≥wi ocean do pla≈ºy? ‚Äì Nic, tylko macha.',
      'Dlaczego komputerowi jest zimno? ‚Äì Bo zostawi≈Ç otwarte okna.',
      'Jak nazywa siƒô zesp√≥≈Ç muzyczny ryb? ‚Äì Rybcy.',
      'Co robi pies na komputerze? ‚Äì Szuka ko≈õci w sieci.',
      'Dlaczego ksiƒÖ≈ºka posz≈Ça do szko≈Çy? ‚Äì Bo chcia≈Ça byƒá mƒÖdrzejsza.',
      'Jak siƒô nazywa kot, kt√≥ry opowiada ≈ºarty? ‚Äì ≈ªartkot.',
      'Dlaczego kredka jest smutna? ‚Äì Bo zawsze jƒÖ ≈ÇamiƒÖ.',
      'Co m√≥wi jedzenie na imprezie? ‚Äì Jedz mnie.',
      'Jak nazywa siƒô ptak, kt√≥ry naprawia samochody? ‚Äì Mechanik.',
      'Dlaczego rower siƒô przewr√≥ci≈Ç? ‚Äì Bo by≈Ç dwuko≈Çowy.',
      'Co robi pi≈Çka no≈ºna na basenie? ‚Äì P≈Çywa w polu karnym.',
      'Jak siƒô nazywa ≈ºaba, kt√≥ra pracuje w banku? ‚Äì Kredytorka.',
      'Dlaczego pomidor siƒô rumieni? ‚Äì Bo zobaczy≈Ç sos.',
      'Co m√≥wi komar, gdy siada na ramieniu? ‚Äì Kr√≥tka wizyta.',
      'Jak nazywa siƒô ko≈Ñ, kt√≥ry pisze ksiƒÖ≈ºki? ‚Äì Autor.',
      'Dlaczego lampka nocna ma dobry humor? ‚Äì Bo zawsze ≈õwieci.',
      'Co robi truskawka na rowerze? ‚Äì Robi d≈ºem.',
      'Dlaczego zegar nie lubi matematyki? ‚Äì Bo wciƒÖ≈º liczy.',
      'Jak siƒô nazywa weso≈Çy og√≥rek? ‚Äì ≈ömieszek.',
      'Co m√≥wi uczona o≈Ç√≥wek? ‚Äì Wiem, gdzie jest kreska.',
      'Dlaczego pajƒÖk jest dobrym webmasterem? ‚Äì Bo zna sieƒá.',
      'Jak siƒô nazywa ≈õlimak, kt√≥ry wygra≈Ç wy≈õcig? ‚Äì ≈ölimak zwyciƒôzca.',
      'Co robi chmura na diecie? ‚Äì Traci parƒô.',
      'Dlaczego s≈Ço≈Ñce jest dobre w ≈ºartach? ‚Äì Bo ma promienny humor.',
      'Jak siƒô nazywa pies, kt√≥ry ta≈Ñczy? ‚Äì Pies w rytmie.',
      'Co m√≥wi pi≈Çkarz, gdy ko≈Ñczy mecz? ‚Äì Kopnƒô to.',
      'Dlaczego muchomor nie chodzi do szko≈Çy? ‚Äì Bo jest trujƒÖcy.',
      'Jak siƒô nazywa modna ryba? ‚Äì Trend.',
      'Co robi skarpetka w lod√≥wce? ‚Äì Szuka pary.',
      'Dlaczego ksiƒô≈ºyc jest zawsze chudy? ‚Äì Bo jest na diecie z ziemniak√≥w.',
      'Jak siƒô nazywa komputer na wakacjach? ‚Äì Laptop pla≈ºowy.',
      'Co robi sok pomara≈Ñczowy na si≈Çowni? ‚Äì Wyciska.',
      'Dlaczego ziarno nie posz≈Ço spaƒá? ‚Äì Bo mia≈Ço kie≈Çki.',
      'Jak siƒô nazywa skaczƒÖca kawa? ‚Äì Espresso.',
      'Co m√≥wi ro≈õlina do ogrodnika? ‚Äì Dziƒôkujƒô za podlewanie.',
      'Dlaczego kokos nie gra w pi≈Çkƒô? ‚Äì Bo ma twardƒÖ g≈Çowƒô.',
      'Jak siƒô nazywa mƒÖdry pies? ‚Äì Pies ze szko≈Çy.',
      'Co robi og√≥rek na pla≈ºy? ‚Äì Opala siƒô w occie.',
      'Dlaczego pi≈Çka koszykowa jest zawsze weso≈Ça? ‚Äì Bo ma wysoki skok.',
      'Jak siƒô nazywa dinozaur, kt√≥ry opowiada dowcipy? ‚Äì ≈ömiesznozaur.',
      'Co m√≥wi ziemniak do frytki? ‚Äì Bƒôdziemy chrupaƒá.',
      'Dlaczego ko≈Ñ nie gra w szachy? ‚Äì Bo boi siƒô hetmana.',
      'Jak siƒô nazywa rycerz, kt√≥ry ≈õpi? ‚Äì ≈öpiƒÖcy rycerz.',
      'Co robi komputer w lesie? ‚Äì Szuka internetu.',
      'Dlaczego jab≈Çko posz≈Ço na spacer? ‚Äì Bo mia≈Ço ochotƒô.',
      'Jak siƒô nazywa ≈õmieszna woda? ‚Äì ≈ömianeczka.',
      'Co m√≥wi noc do dnia? ‚Äì Wymieniamy siƒô.',
      'Dlaczego kaczka nie nosi but√≥w? ‚Äì Bo ma p≈Çetwy.',
      'Jak siƒô nazywa kot, kt√≥ry lata samolotem? ‚Äì Pilot.',
      'Co robi chleb w kinie? ‚Äì Je okruszki.',
      'Dlaczego gruszka jest zadowolona? ‚Äì Bo ma dobry kszta≈Çt.',
      'Jak siƒô nazywa pies, kt√≥ry jest kucharzem? ‚Äì Sier≈õciuch.',
      'Co m√≥wi rower do samochodu? ‚Äì Ale masz wygodƒô.',
      'Dlaczego s≈Ço≈Ñce nie chodzi do szko≈Çy? ‚Äì Bo jest ju≈º ≈õwiat≈Çe.',
      'Jak siƒô nazywa mysz, kt√≥ra zna karate? ‚Äì My-szu.',
      'Co robi marchewka na randce? ‚Äì Daje komplementy.',
      'Dlaczego krowa lubi muzykƒô? ‚Äì Bo ma dobre uszy.',
      'Jak siƒô nazywa wƒÖ≈º, kt√≥ry opowiada bajki? ‚Äì Gadu≈Ça.',
      'Co m√≥wi ksiƒô≈ºyc do gwiazd? ‚Äì ≈öwieƒácie dalej.',
      'Dlaczego st√≥≈Ç ma cztery nogi? ‚Äì Bo tak mu wygodnie.',
      'Jak siƒô nazywa pies, kt√≥ry biega za kotem? ‚Äì Biegacz.',
      'Co robi woda w zimie? ‚Äì Zamarza.',
      'Dlaczego zielony groszek jest zielony? ‚Äì Bo siƒô zieleni.',
      'Jak siƒô nazywa ≈õmieszny grzyb? ‚Äì Borowik dowcip.',
      'Co m√≥wi drzewo do wiatru? ‚Äì Nie ko≈Çysz mnƒÖ.',
      'Dlaczego pi≈Çkarz zabra≈Ç o≈Ç√≥wek na boisko? ‚Äì ≈ªeby narysowaƒá gole.',
      'Jak siƒô nazywa kura na rowerze? ‚Äì Kurier.',
      'Co robi zima latem? ‚Äì Czeka na swojƒÖ kolej.',
      'Dlaczego pies siedzi w kieszeni? ‚Äì Bo jest kieszonkowy.',
      'Jak siƒô nazywa s≈Ço≈Ñ p≈ÇywajƒÖcy w oceanie? ‚Äì S≈Çona ryba.',
      'Co m√≥wi piasek do wiatru? ‚Äì Nie zwiewaj mnie.',
      'Dlaczego telefon jest zmƒôczony? ‚Äì Bo ma du≈ºo po≈ÇƒÖcze≈Ñ.',
      'Jak siƒô nazywa ≈ºartujƒÖcy nauczyciel? ‚Äì Dowcipasz.',
      'Co robi zegarek na pla≈ºy? ‚Äì Robi czas wolny.',
      'Dlaczego kwiat siƒô u≈õmiecha? ‚Äì Bo jest podlewany.',
      'Jak siƒô nazywa pluszowy mi≈õ, kt√≥ry podr√≥≈ºuje? ‚Äì Turysta.',
      'Co m√≥wi l√≥d do wody? ‚Äì Do zobaczenia latem.',
      'Dlaczego zajƒÖc nie lubi g≈Ço≈õnych d≈∫wiƒôk√≥w? ‚Äì Bo ma delikatne uszy.',
      'Jak siƒô nazywa ma≈Çy krowa? ‚Äì Kr√≥wka.',
      'Co robi chmura w nocy? ‚Äì ≈öpi.',
      'Dlaczego kukurydza jest wysoka? ‚Äì Bo ro≈õnie w g√≥rƒô.',
      'Jak siƒô nazywa leniwy pies? ‚Äì Drzemek.',
      'Co m√≥wi ziemia do nasion? ‚Äì Witajcie.',
      'Dlaczego samoch√≥d nie je ≈õniadania? ‚Äì Bo ju≈º ma paliwo.',
      'Jak siƒô nazywa szczƒô≈õliwy banan? ‚Äì U≈õmiech.',
      'Co robi kot na drzewie? ‚Äì Miauczy na wysoko≈õci.',
      'Dlaczego konik polny nie chodzi? ‚Äì Bo skacze.',
      'Jak siƒô nazywa przyjazny rekin? ‚Äì Rybak przyjaciel.'
    ];

    let QUESTIONS = buildQuestions();
    let order = shuffleArray([...Array(QUESTIONS.length).keys()]);
    let state = { idx:0, score:0, lives:3, locked:false, selected:null, log:[] };

    // --- Elementy ---
    const elQ = document.getElementById('question');
    const elOptions = document.getElementById('options');
    const elNext = document.getElementById('nextBtn');
    const elBar = document.getElementById('bar');
    const elQIdx = document.getElementById('qidx');
    const elLvl = document.getElementById('level');
    const elScore = document.getElementById('score');
    const elLives = document.getElementById('lives');
    const elHint = document.getElementById('hint');
    const elReset = document.getElementById('resetBtn');
    const elSummary = document.getElementById('summary');
    const elGame = document.getElementById('game');
    const elSummaryText = document.getElementById('summaryText');
    const elAgain = document.getElementById('againBtn');
    const elShowAnswers = document.getElementById('showAnswersBtn');
    const elAnswersList = document.getElementById('answersList');
    const elSummaryTitle = document.getElementById('summaryTitle');
    const elSummaryTime = document.getElementById('summaryTime');
    const elJoke = document.getElementById('jokeBox');

    function updateHUD(){
      const total = QUESTIONS.length;
      elQIdx.textContent = `Pytanie ${state.idx+1}/${total}`;
      elBar.style.width = `${((state.idx)/total)*100}%`;
      elScore.textContent = `Punkty: ${state.score}`;
      elLvl.textContent = `Poziom: ${1 + Math.floor(state.score/30)}`;
      elLives.textContent = '‚ù§Ô∏è'.repeat(state.lives) || '‚Äî';
    }

    function createAxisSVG({min,max,point}){
      const width = 360, height = 60, margin = 20;
      const axisW = width - margin*2;
      const x = v => margin + ( (v - min) / (max - min) ) * axisW;
      const tickStep = (max-min)/5;
      const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
      svg.setAttribute('viewBox',`0 0 ${width} ${height}`);
      svg.setAttribute('width','100%');
      // baseline
      const line = document.createElementNS(svg.namespaceURI,'line');
      line.setAttribute('x1',margin); line.setAttribute('x2',width-margin);
      line.setAttribute('y1',height/2); line.setAttribute('y2',height/2);
      line.setAttribute('stroke','#cfe8ff'); line.setAttribute('stroke-width','2');
      svg.appendChild(line);
      // arrow
      const arr = document.createElementNS(svg.namespaceURI,'polygon');
      arr.setAttribute('points', `${width-margin},${height/2-4} ${width-margin},${height/2+4} ${width-margin+12},${height/2}`);
      arr.setAttribute('fill','#cfe8ff');
      svg.appendChild(arr);
      // ticks & labels
      for(let v=min; v<=max; v+=tickStep){
        const lx = x(v);
        const tick = document.createElementNS(svg.namespaceURI,'line');
        tick.setAttribute('x1',lx); tick.setAttribute('x2',lx);
        tick.setAttribute('y1',height/2-10); tick.setAttribute('y2',height/2+10);
        tick.setAttribute('stroke','#cfe8ff'); tick.setAttribute('stroke-width','2');
        svg.appendChild(tick);
        const lbl = document.createElementNS(svg.namespaceURI,'text');
        lbl.setAttribute('x',lx); lbl.setAttribute('y',height-6);
        lbl.setAttribute('fill','#e6f0ff'); lbl.setAttribute('font-size','12');
        lbl.setAttribute('text-anchor','middle');
        lbl.textContent = Math.round(v).toString();
        svg.appendChild(lbl);
      }
      // point A
      const dot = document.createElementNS(svg.namespaceURI,'circle');
      dot.setAttribute('cx', x(point)); dot.setAttribute('cy', height/2);
      dot.setAttribute('r','4'); dot.setAttribute('fill','#ffb24a');
      svg.appendChild(dot);
      const label = document.createElementNS(svg.namespaceURI,'text');
      label.setAttribute('x', x(point)); label.setAttribute('y', 16);
      label.setAttribute('fill','#e6f0ff'); label.setAttribute('font-size','14');
      label.setAttribute('text-anchor','middle'); label.textContent='A';
      svg.appendChild(label);
      return svg;
    }

    function renderQuestion(){
      updateHUD();
      elOptions.innerHTML = '';
      const qIndex = order[state.idx];
      const data = QUESTIONS[qIndex];
      elQ.innerHTML = `<span class="qtitle">Zadanie ${state.idx+1}:</span><br>${data.q}`; // dwukropek po numerze
      // je≈õli to o≈õ liczbowa ‚Äî dorysuj
      if(data.axis){
        const wrap = document.createElement('div');
        wrap.style.marginTop = '8px';
        wrap.appendChild(createAxisSVG(data.axis));
        elQ.appendChild(wrap);
      }
      // przygotuj opcje
      const indexed = data.opts.map((text,i)=>({text, i, correct:i===data.correct}));
      shuffleArray(indexed);
      indexed.forEach((opt)=>{
        const b = document.createElement('button');
        b.className='btn';
        b.textContent=opt.text;
        b.setAttribute('data-correct', opt.correct ? '1':'0');
        b.onclick = ()=> chooseAnswer(b, opt, data);
        elOptions.appendChild(b);
      });
      elNext.disabled = true;
      elHint.textContent = 'Kliknij poprawnƒÖ odpowied≈∫. G≈Ço≈õno wyt≈Çumacz sw√≥j spos√≥b liczenia!';
      state.selected=null; state.locked=false;
    }

    function chooseAnswer(btn, opt, data){
      if(state.locked) return;
      state.locked = true; state.selected = btn;
      const buttons = [...document.querySelectorAll('#options .btn')];
      buttons.forEach(b => b.disabled = true);
      const correctBtn = buttons.find(b=>b.dataset.correct==='1');
      const chosenText = btn.textContent; const correctText = correctBtn?correctBtn.textContent:'';
      let isCorrect=false;
      if(opt.correct){
        btn.classList.add('correct');
        state.score += 10;
        elHint.textContent = 'Brawo! Sti≈õ znalaz≈Ç ananasa! üçç +10 punkt√≥w';
        confetti();
        isCorrect=true;
      } else {
        btn.classList.add('wrong');
        state.lives -= 1;
        elHint.textContent = 'Ups! Tym razem nie. Spr√≥buj stosowaƒá kolejno≈õƒá dzia≈Ça≈Ñ albo policz na brudno.';
        elGame.classList.add('shake'); setTimeout(()=>elGame.classList.remove('shake'), 420);
        if(correctBtn) correctBtn.classList.add('correct');
        if(state.lives<=0){
          state.log.push({ no: state.idx+1, q:data.q, chosen:chosenText, correct:correctText, ok:false });
          endGame(false);
          return;
        }
      }
      state.log.push({ no: state.idx+1, q:data.q, chosen:chosenText, correct:correctText, ok:isCorrect });

      // AUTO-FINISH on last question to make mobile flow easier
      if(state.idx === QUESTIONS.length-1){
        elNext.disabled = true;
        updateHUD();
        setTimeout(()=> endGame(true), 650);
      } else {
        elNext.disabled = false;
        updateHUD();
      }
    }

    function next(){
      if(state.idx < QUESTIONS.length-1){ state.idx++; renderQuestion(); }
      else { endGame(true); }
    }

    function funnySVG(ok){
      // ≈õmieszny ananas z okularami przeciws≈Çonecznymi (inline SVG autorskie)
      const color = ok? '#34d399' : '#ef4444';
      return `
      <svg width="180" height="160" viewBox="0 0 180 160" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="#ffe08a"/>
            <stop offset="100%" stop-color="#ffb24a"/>
          </linearGradient>
        </defs>
        <g transform="translate(10,5)">
          <polygon points="80,0 70,20 90,20" fill="#5bd37e"/>
          <polygon points="60,10 50,30 70,30" fill="#45c06a"/>
          <polygon points="100,10 90,30 110,30" fill="#45c06a"/>
          <ellipse cx="80" cy="95" rx="55" ry="55" fill="url(#g1)" stroke="#e39b2d" stroke-width="3"/>
          <rect x="38" y="70" width="84" height="22" rx="10" fill="#0b1220" stroke="#6cf" stroke-width="3"/>
          <circle cx="58" cy="81" r="8" fill="#12203a" stroke="#6cf" stroke-width="3"/>
          <circle cx="102" cy="81" r="8" fill="#12203a" stroke="#6cf" stroke-width="3"/>
          <path d="M55 110 Q80 125 105 110" stroke="${color}" stroke-width="6" fill="none" stroke-linecap="round"/>
        </g>
      </svg>`;
    }

    function resultSVG(ok){
      if(ok){
        return `<svg viewBox='0 0 96 96' width='84' height='84' xmlns='http://www.w3.org/2000/svg'>
          <defs><linearGradient id='gg' x1='0' x2='0' y1='0' y2='1'><stop offset='0%' stop-color='#5ff2b0'/><stop offset='100%' stop-color='#34d399'/></linearGradient></defs>
          <circle cx='48' cy='48' r='44' fill='url(#gg)' stroke='#0b3a2a' stroke-width='4'/>
          <path d='M28 50 L42 64 L70 36' fill='none' stroke='#05223f' stroke-width='8' stroke-linecap='round' stroke-linejoin='round'/>
        </svg>`;
      }
      return `<svg viewBox='0 0 96 96' width='84' height='84' xmlns='http://www.w3.org/2000/svg'>
        <defs><linearGradient id='rg' x1='0' x2='0' y1='0' y2='1'><stop offset='0%' stop-color='#ff8a8a'/><stop offset='100%' stop-color='#ef4444'/></linearGradient></defs>
        <circle cx='48' cy='48' r='44' fill='url(#rg)' stroke='#3a0b0b' stroke-width='4'/>
        <path d='M32 32 L64 64 M64 32 L32 64' stroke='#05223f' stroke-width='8' stroke-linecap='round'/>
      </svg>`;
    }

    function endGame(completed){
      const total=QUESTIONS.length; const percent=Math.round((state.score/(total*10))*100);
      document.getElementById('bar').style.width = '100%';
      elGame.classList.add('hidden');
      elSummary.classList.remove('hidden');

      // Ustaw tytu≈Ç (sukces/pora≈ºka) i czas
      elSummaryTitle.textContent = completed ? 'SUKCES! üéâ' : 'NIE ZALICZONO üòø';
      const ts = new Date().toLocaleString('pl-PL');
      const hearts = state.lives>0 ? '‚ù§Ô∏è'.repeat(state.lives) : '‚Äî';
      elSummaryTime.innerHTML = `${ts} ‚Ä¢ Pozosta≈Çe ≈ºycia: <b>${state.lives}</b> ${hearts}`;

      // Dowcip tylko gdy sukces; przy pora≈ºce ‚Äî smutna minka i ≈ºart dopiero po wygranej
      if (completed) {
        const joke = JOKES_PL[Math.floor(Math.random()*JOKES_PL.length)];
        elJoke.textContent = joke;
      } else {
        elJoke.innerHTML = 'üòø Dzi≈õ bez ≈ºartu ‚Äî <b>≈ºarty sƒÖ dla zwyciƒôzc√≥w</b>. Wr√≥ƒá po u≈õmiech w nastƒôpnej rundzie!';
      }

      // Lista odpowiedzi (wy≈õrodkowana, ale wyr√≥wnanie tekstu do lewej)
      const list = document.createElement('ol');
      list.style.margin = '0';
      list.style.paddingLeft = '18px';
      state.log.forEach(item=>{
        const li = document.createElement('li');
        li.style.margin = '8px 0';
        li.style.textAlign = 'left';
        const mark = item.ok ? '<span class="ok">‚úî poprawnie</span>' : '<span class="no">‚úñ b≈Çƒôdnie</span>';
        li.innerHTML = `<div><strong>Zadanie ${item.no}:</strong> ${item.q}</div>
                        <div>Wybrano: <b>${item.chosen||'‚Äî'}</b> &nbsp;‚Ä¢&nbsp; Poprawna: <b>${item.correct}</b> &nbsp;${mark}</div>`;
        list.appendChild(li);
      });
      elAnswersList.innerHTML='';
      elAnswersList.appendChild(list);

      // Tekst nad listƒÖ
      elSummaryText && (elSummaryText.textContent = completed
        ? `Misja zako≈Ñczona! Sti≈õ jest dumny! üöÄ`
        : `Koniec ≈ºyƒá. Spr√≥buj ponownie ‚Äî wierzymy w Ciebie! üí™`);
    }

    function restart(){
      QUESTIONS = buildQuestions();
      order = shuffleArray([...Array(QUESTIONS.length).keys()]);
      state = { idx:0, score:0, lives:3, locked:false, selected:null, log:[] };
      elSummary.classList.add('hidden');
      elAnswersList.innerHTML='';
      elGame.classList.remove('hidden');
      renderQuestion();
    }

    document.getElementById('nextBtn').addEventListener('click', next);
    document.getElementById('resetBtn').addEventListener('click', restart);
    document.getElementById('againBtn').addEventListener('click', restart);

    function confetti(){
      const c = document.getElementById('confetti');
      const ctx = c.getContext('2d');
      const W = c.width = window.innerWidth; const H = c.height = window.innerHeight;
      const pieces = Array.from({length: 80}, () => ({
        x: Math.random()*W, y: -20, r: 2 + Math.random()*4,
        vx: -1 + Math.random()*2, vy: 2 + Math.random()*3,
        rot: Math.random()*Math.PI, vr: -0.2 + Math.random()*0.4
      }));
      const start = performance.now();
      (function tick(now){
        const t = now - start; ctx.clearRect(0,0,W,H);
        pieces.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle = `hsl(${(p.x/W)*360}, 90%, 60%)`; ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2); ctx.restore(); });
      if(t<550) requestAnimationFrame(tick); else ctx.clearRect(0,0,W,H);
      })(start);
    }

    // Random rocket antics
    function spawnRocket(){
      const r=document.createElement('div');
      r.className='rocket';
      r.textContent='üöÄ';
      document.body.appendChild(r);
      const startX=Math.random()*window.innerWidth;
      const targetX=Math.random()*window.innerWidth;
      const targetY=Math.random()*window.innerHeight;
      const angle=Math.atan2(targetY+60,targetX-startX)*180/Math.PI;
      const rotation=angle+45; // Adjust for emoji's default 45deg orientation and rotate 90¬∞ clockwise
      r.style.transform=`translate(${startX}px,-60px) rotate(${rotation}deg)`;
      r.offsetWidth;
      r.style.transform=`translate(${targetX}px,${targetY}px) rotate(${rotation}deg)`;
      r.addEventListener('transitionend',()=>{
        const rect=r.getBoundingClientRect();
        const rad=Math.atan2(targetY+60,targetX-startX);
        const headX=rect.left+rect.width/2+Math.cos(rad)*rect.height/2;
        const headY=rect.top+rect.height/2+Math.sin(rad)*rect.height/2;
        r.remove();
        boom(headX,headY);
      },{once:true});
    }
    function boom(x,y){
      const count=3+Math.floor(Math.random()*4);
      for(let i=0;i<count;i++){
        const b=document.createElement('div');
        b.className='boom';
        b.textContent='üí•';
        const ang=Math.random()*Math.PI*2;
        const dist=10+Math.random()*30;
        b.style.left=`${x+Math.cos(ang)*dist}px`;
        b.style.top=`${y+Math.sin(ang)*dist}px`;
        document.body.appendChild(b);
        setTimeout(()=>b.remove(),700);
      }
    }
    (function rocketLoop(){
      const delay=5000+Math.random()*10000;
      setTimeout(()=>{spawnRocket(); rocketLoop();},delay);
    })();

    document.getElementById('buildInfo').textContent =
      'Wersja z: ' + new Date(document.lastModified).toLocaleString('pl-PL');

    // Start gry
    renderQuestion();
  </script>
</body>
</html>
